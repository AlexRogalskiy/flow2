collections:
  - name: ticks
    schema: schemas/L1-tick.yaml
    key: [/id]
    fixtures: [fixtures/L1-tick.yaml]

    projections:
      - name: exchange
        ptr: /exchange
        partition: true
      - name: bar
        ptr: /bar

  - name: daily-stats
    schema: schemas/daily-stat.yaml
    key: [/security, /date]
    fixtures: [fixtures/daily-stats.yaml]

    projections:
      - name: exchange
        ptr: /exchange
        partition: true
      - name: my_special_column
        ptr: /bid/high

    derivation:
      runtime: jq
      transforms:
        - source: ticks
          path: lambdas/map-tick-to-daily-stats.jq

materializations:
  - collection: daily-stats

    target:
      type: postgres
      endpoint: postgres://127.0.0.1:5432/my-db
      table: daily_stats
