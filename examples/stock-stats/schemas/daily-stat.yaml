description: Daily statistics of a market security.

type: object
reduce:
  strategy: merge
required: [exchange, security, date]

properties:
  # Grouped dimensions of the record.
  exchange: { $ref: exchange.yaml }
  security: { $ref: L1-tick.yaml#/$defs/security }
  date:
    type: string
    format: date

  # Metrics of the record.
  price:
    description: Low, high, and average transaction price (weighted by shares).
    $ref: "#/$defs/priceStats"
  bid:
    description: Low, high, and average bid price.
    $ref: "#/$defs/priceStats"
  ask:
    description: Low, high, and average ask price.
    $ref: "#/$defs/priceStats"
  spread:
    description: Low, high, and average spread of bid vs ask.
    $ref: "#/$defs/priceStats"
  volume:
    description: Total number of shares transacted.
    type: integer
    reduce: {strategy: sum}
  first:
    description: First trade of the day.
    $ref: L1-tick.yaml#/$defs/priceAndSize
    reduce: {strategy: firstWriteWins}
  last:
    description: Last trade of the day.
    $ref: L1-tick.yaml#/$defs/priceAndSize
    reduce: {strategy: lastWriteWins}

$defs:
  priceStats:
    type: object
    reduce: {strategy: merge}

    properties:
      low:
        type: number
        reduce: {strategy: minimize}
      high:
        type: number
        reduce: {strategy: maximize}
      avgN:
        description: Numerator of average.
        type: number
        reduce: {strategy: sum}
      avgD:
        description: Denominator of average.
        type: number
        reduce: {strategy: sum}

